using System.Linq;
using Thinktecture.CodeAnalysis.DiscriminatedUnions;
using Xunit.Abstractions;

namespace Thinktecture.Runtime.Tests.SourceGeneratorTests;

public class UnionSourceGeneratorTests : SourceGeneratorTestsBase
{
   private const string _GENERATED_HEADER = """
                                            // <auto-generated />
                                            #nullable enable


                                            """;

   public UnionSourceGeneratorTests(ITestOutputHelper output)
      : base(output)
   {
   }

   [Fact]
   public void Should_generate_class_with_string_and_int()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_struct_with_string_and_int()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>]
                   	public partial struct TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      [global::System.Runtime.InteropServices.StructLayout(global::System.Runtime.InteropServices.LayoutKind.Auto)]
                                                      readonly partial struct TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion obj, global::Thinktecture.Tests.TestUnion other)
                                                         {
                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion obj, global::Thinktecture.Tests.TestUnion other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion other)
                                                         {
                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_ref_struct_with_string_and_int()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>]
                   	public ref partial struct TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      [global::System.Runtime.InteropServices.StructLayout(global::System.Runtime.InteropServices.LayoutKind.Auto)]
                                                      readonly partial struct TestUnion
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         /// <exception cref="System.InvalidOperationException">If the union (struct) is not initialized or initialized with default value.</exception>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 0:
                                                                  throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values.");
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion obj, global::Thinktecture.Tests.TestUnion other)
                                                         {
                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion obj, global::Thinktecture.Tests.TestUnion other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return false;
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion other)
                                                         {
                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               0 => throw new global::System.InvalidOperationException($"This struct of type 'TestUnion' is not initialized. Make sure all fields, properties and variables are initialized with non-default values."),
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_without_implicit_conversion()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(SkipImplicitConversionFromValue = true)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_with_private_ctors()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(ConstructorAccessModifier = UnionConstructorAccessModifier.Private)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         private TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         private TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_with_SwitchPartially()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(SwitchMethods = SwitchMapMethodsGeneration.DefaultWithPartialOverloads)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="default">The action to execute if no value-specific action is provided.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void SwitchPartially(
                                                            global::System.Action<object?>? @default = null,
                                                            global::System.Action<string>? @string = null,
                                                            global::System.Action<int>? @int32 = null)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  if (@string is null)
                                                                     break;

                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  if (@int32 is null)
                                                                     break;

                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }

                                                            @default?.Invoke(this.Value);
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="default">The action to execute if no value-specific action is provided.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void SwitchPartially<TState>(
                                                            TState state,
                                                            global::System.Action<TState, object?>? @default = null,
                                                            global::System.Action<TState, string>? @string = null,
                                                            global::System.Action<TState, int>? @int32 = null)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  if (@string is null)
                                                                     break;

                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  if (@int32 is null)
                                                                     break;

                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }

                                                            @default?.Invoke(state, this.Value);
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="default">The function to execute if no value-specific action is provided.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult SwitchPartially<TResult>(
                                                            global::System.Func<object?, TResult> @default,
                                                            global::System.Func<string, TResult>? @string = null,
                                                            global::System.Func<int, TResult>? @int32 = null)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  if (@string is null)
                                                                     break;

                                                                  return @string(this._string!);
                                                               case 2:
                                                                  if (@int32 is null)
                                                                     break;

                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }

                                                            return @default(this.Value);
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="default">The function to execute if no value-specific action is provided.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult SwitchPartially<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, object?, TResult> @default,
                                                            global::System.Func<TState, string, TResult>? @string = null,
                                                            global::System.Func<TState, int, TResult>? @int32 = null)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  if (@string is null)
                                                                     break;

                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  if (@int32 is null)
                                                                     break;

                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }

                                                            return @default(state, this.Value);
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_with_MapPartially()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(MapMethods = SwitchMapMethodsGeneration.DefaultWithPartialOverloads)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="default">The instance to return if no value is provided for the current value.</param>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult MapPartially<TResult>(
                                                            TResult @default,
                                                            global::Thinktecture.Argument<TResult> @string = default,
                                                            global::Thinktecture.Argument<TResult> @int32 = default)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  if (!@string.IsSet)
                                                                     break;

                                                                  return @string.Value;
                                                               case 2:
                                                                  if (!@int32.IsSet)
                                                                     break;

                                                                  return @int32.Value;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }

                                                            return @default;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_without_Map()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(MapMethods = SwitchMapMethodsGeneration.None)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_without_Switch()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(SwitchMethods = SwitchMapMethodsGeneration.None)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_without_ToString()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(SkipToString = true)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_and_custom_string_comparison()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(DefaultStringComparison = StringComparison.Ordinal)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.Ordinal),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.Ordinal) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_nullable_string_and_nullable_int()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int?>(T1IsNullableReferenceType = true)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int? _nullableInt32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <c>string?</c>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <c>int?</c>.
                                                         /// </summary>
                                                         public bool IsNullableInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <c>string?</c>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <c>string?</c>.</exception>
                                                         public string? AsString => IsString ? this._string : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string?'.");

                                                         /// <summary>
                                                         /// Gets the current value as <c>int?</c>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <c>int?</c>.</exception>
                                                         public int? AsNullableInt32 => IsNullableInt32 ? this._nullableInt32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int?'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object? Value => this._valueIndex switch
                                                         {
                                                            1 => this._string,
                                                            2 => this._nullableInt32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string? @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="nullableInt32"/>.
                                                         /// </summary>
                                                         /// <param name="nullableInt32">Value to create a new instance for.</param>
                                                         public TestUnion(int? @nullableInt32)
                                                         {
                                                            this._nullableInt32 = @nullableInt32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The action to execute if the current value is of type <c>int?</c>.</param>
                                                         public void Switch(
                                                            global::System.Action<string?> @string,
                                                            global::System.Action<int?> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string);
                                                                  return;
                                                               case 2:
                                                                  @nullableInt32(this._nullableInt32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The action to execute if the current value is of type <c>int?</c>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string?> @string,
                                                            global::System.Action<TState, int?> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string);
                                                                  return;
                                                               case 2:
                                                                  @nullableInt32(state, this._nullableInt32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The function to execute if the current value is of type <c>int?</c>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string?, TResult> @string,
                                                            global::System.Func<int?, TResult> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string);
                                                               case 2:
                                                                  return @nullableInt32(this._nullableInt32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The function to execute if the current value is of type <c>int?</c>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string?, TResult> @string,
                                                            global::System.Func<TState, int?, TResult> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string);
                                                               case 2:
                                                                  return @nullableInt32(state, this._nullableInt32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The instance to return if the current value is of type <c>int?</c>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @nullableInt32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <c>string?</c>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string? @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <c>int?</c>.
                                                         /// </summary>
                                                         /// <param name="nullableInt32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="nullableInt32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int? @nullableInt32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@nullableInt32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <c>string?</c>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <c>string?</c>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <c>string?</c>.</exception>
                                                         public static explicit operator string?(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <c>int?</c>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <c>int?</c>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <c>int?</c>.</exception>
                                                         public static explicit operator int?(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsNullableInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._nullableInt32.Equals(other._nullableInt32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._nullableInt32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._nullableInt32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_with_custom_names()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int>(T1Name = "Text", T2Name = "Number")]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _text;
                                                         private readonly int _number;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsText => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsNumber => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsText => IsText ? this._text! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsNumber => IsNumber ? this._number : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._text!,
                                                            2 => this._number,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="text"/>.
                                                         /// </summary>
                                                         /// <param name="text">Value to create a new instance for.</param>
                                                         public TestUnion(string @text)
                                                         {
                                                            this._text = @text;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="number"/>.
                                                         /// </summary>
                                                         /// <param name="number">Value to create a new instance for.</param>
                                                         public TestUnion(int @number)
                                                         {
                                                            this._number = @number;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="text">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="number">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @text,
                                                            global::System.Action<int> @number)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @text(this._text!);
                                                                  return;
                                                               case 2:
                                                                  @number(this._number);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="text">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="number">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @text,
                                                            global::System.Action<TState, int> @number)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @text(state, this._text!);
                                                                  return;
                                                               case 2:
                                                                  @number(state, this._number);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="text">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="number">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @text,
                                                            global::System.Func<int, TResult> @number)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @text(this._text!);
                                                               case 2:
                                                                  return @number(this._number);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="text">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="number">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @text,
                                                            global::System.Func<TState, int, TResult> @number)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @text(state, this._text!);
                                                               case 2:
                                                                  return @number(state, this._number);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="text">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="number">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @text,
                                                            TResult @number)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @text;
                                                               case 2:
                                                                  return @number;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="text">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="text"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @text)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@text);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="number">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="number"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @number)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@number);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsText;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsNumber;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._text is null ? other._text is null : this._text.Equals(other._text, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._number.Equals(other._number),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._text?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._number.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._text,
                                                               2 => this._number.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_string_and_int_bool_guid_char()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int, bool, Guid, char>]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;
                                                         private readonly bool _boolean;
                                                         private readonly global::System.Guid _guid;
                                                         private readonly char _char;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="bool"/>.
                                                         /// </summary>
                                                         public bool IsBoolean => this._valueIndex == 3;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="global::System.Guid"/>.
                                                         /// </summary>
                                                         public bool IsGuid => this._valueIndex == 4;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="char"/>.
                                                         /// </summary>
                                                         public bool IsChar => this._valueIndex == 5;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString => IsString ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="bool"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="bool"/>.</exception>
                                                         public bool AsBoolean => IsBoolean ? this._boolean : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'bool'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="global::System.Guid"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="global::System.Guid"/>.</exception>
                                                         public global::System.Guid AsGuid => IsGuid ? this._guid : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'Guid'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="char"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="char"/>.</exception>
                                                         public char AsChar => IsChar ? this._char : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'char'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._string!,
                                                            2 => this._int32,
                                                            3 => this._boolean,
                                                            4 => this._guid,
                                                            5 => this._char,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to create a new instance for.</param>
                                                         public TestUnion(string @string)
                                                         {
                                                            this._string = @string;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="boolean"/>.
                                                         /// </summary>
                                                         /// <param name="boolean">Value to create a new instance for.</param>
                                                         public TestUnion(bool @boolean)
                                                         {
                                                            this._boolean = @boolean;
                                                            this._valueIndex = 3;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="guid"/>.
                                                         /// </summary>
                                                         /// <param name="guid">Value to create a new instance for.</param>
                                                         public TestUnion(global::System.Guid @guid)
                                                         {
                                                            this._guid = @guid;
                                                            this._valueIndex = 4;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="char"/>.
                                                         /// </summary>
                                                         /// <param name="char">Value to create a new instance for.</param>
                                                         public TestUnion(char @char)
                                                         {
                                                            this._char = @char;
                                                            this._valueIndex = 5;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="boolean">The action to execute if the current value is of type <see cref="bool"/>.</param>
                                                         /// <param name="guid">The action to execute if the current value is of type <see cref="global::System.Guid"/>.</param>
                                                         /// <param name="char">The action to execute if the current value is of type <see cref="char"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @string,
                                                            global::System.Action<int> @int32,
                                                            global::System.Action<bool> @boolean,
                                                            global::System.Action<global::System.Guid> @guid,
                                                            global::System.Action<char> @char)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               case 3:
                                                                  @boolean(this._boolean);
                                                                  return;
                                                               case 4:
                                                                  @guid(this._guid);
                                                                  return;
                                                               case 5:
                                                                  @char(this._char);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="boolean">The action to execute if the current value is of type <see cref="bool"/>.</param>
                                                         /// <param name="guid">The action to execute if the current value is of type <see cref="global::System.Guid"/>.</param>
                                                         /// <param name="char">The action to execute if the current value is of type <see cref="char"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @string,
                                                            global::System.Action<TState, int> @int32,
                                                            global::System.Action<TState, bool> @boolean,
                                                            global::System.Action<TState, global::System.Guid> @guid,
                                                            global::System.Action<TState, char> @char)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @string(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               case 3:
                                                                  @boolean(state, this._boolean);
                                                                  return;
                                                               case 4:
                                                                  @guid(state, this._guid);
                                                                  return;
                                                               case 5:
                                                                  @char(state, this._char);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="boolean">The function to execute if the current value is of type <see cref="bool"/>.</param>
                                                         /// <param name="guid">The function to execute if the current value is of type <see cref="global::System.Guid"/>.</param>
                                                         /// <param name="char">The function to execute if the current value is of type <see cref="char"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @string,
                                                            global::System.Func<int, TResult> @int32,
                                                            global::System.Func<bool, TResult> @boolean,
                                                            global::System.Func<global::System.Guid, TResult> @guid,
                                                            global::System.Func<char, TResult> @char)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               case 3:
                                                                  return @boolean(this._boolean);
                                                               case 4:
                                                                  return @guid(this._guid);
                                                               case 5:
                                                                  return @char(this._char);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="string">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="boolean">The function to execute if the current value is of type <see cref="bool"/>.</param>
                                                         /// <param name="guid">The function to execute if the current value is of type <see cref="global::System.Guid"/>.</param>
                                                         /// <param name="char">The function to execute if the current value is of type <see cref="char"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @string,
                                                            global::System.Func<TState, int, TResult> @int32,
                                                            global::System.Func<TState, bool, TResult> @boolean,
                                                            global::System.Func<TState, global::System.Guid, TResult> @guid,
                                                            global::System.Func<TState, char, TResult> @char)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               case 3:
                                                                  return @boolean(state, this._boolean);
                                                               case 4:
                                                                  return @guid(state, this._guid);
                                                               case 5:
                                                                  return @char(state, this._char);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="string">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="boolean">The instance to return if the current value is of type <see cref="bool"/>.</param>
                                                         /// <param name="guid">The instance to return if the current value is of type <see cref="global::System.Guid"/>.</param>
                                                         /// <param name="char">The instance to return if the current value is of type <see cref="char"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @string,
                                                            TResult @int32,
                                                            TResult @boolean,
                                                            TResult @guid,
                                                            TResult @char)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @string;
                                                               case 2:
                                                                  return @int32;
                                                               case 3:
                                                                  return @boolean;
                                                               case 4:
                                                                  return @guid;
                                                               case 5:
                                                                  return @char;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="string">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="string"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string @string)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@string);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="bool"/>.
                                                         /// </summary>
                                                         /// <param name="boolean">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="boolean"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(bool @boolean)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@boolean);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="global::System.Guid"/>.
                                                         /// </summary>
                                                         /// <param name="guid">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="guid"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(global::System.Guid @guid)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@guid);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="char"/>.
                                                         /// </summary>
                                                         /// <param name="char">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="char"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(char @char)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@char);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="string"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="string"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="string"/>.</exception>
                                                         public static explicit operator string(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsString;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="bool"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="bool"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="bool"/>.</exception>
                                                         public static explicit operator bool(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsBoolean;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="global::System.Guid"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="global::System.Guid"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="global::System.Guid"/>.</exception>
                                                         public static explicit operator global::System.Guid(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsGuid;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="char"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="char"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="char"/>.</exception>
                                                         public static explicit operator char(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsChar;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               3 => this._boolean.Equals(other._boolean),
                                                               4 => this._guid.Equals(other._guid),
                                                               5 => this._char.Equals(other._char),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               3 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._boolean.GetHashCode()),
                                                               4 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._guid.GetHashCode()),
                                                               5 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._char.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               3 => this._boolean.ToString(),
                                                               4 => this._guid.ToString(),
                                                               5 => this._char.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_array()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string[], int>]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string[]? _stringArray;
                                                         private readonly int _int32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <c>string[]</c>.
                                                         /// </summary>
                                                         public bool IsStringArray => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Gets the current value as <c>string[]</c>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <c>string[]</c>.</exception>
                                                         public string[] AsStringArray => IsStringArray ? this._stringArray! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string[]'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object Value => this._valueIndex switch
                                                         {
                                                            1 => this._stringArray!,
                                                            2 => this._int32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="stringArray"/>.
                                                         /// </summary>
                                                         /// <param name="stringArray">Value to create a new instance for.</param>
                                                         public TestUnion(string[] @stringArray)
                                                         {
                                                            this._stringArray = @stringArray;
                                                            this._valueIndex = 1;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="stringArray">The action to execute if the current value is of type <c>string[]</c>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch(
                                                            global::System.Action<string[]> @stringArray,
                                                            global::System.Action<int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @stringArray(this._stringArray!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="stringArray">The action to execute if the current value is of type <c>string[]</c>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string[]> @stringArray,
                                                            global::System.Action<TState, int> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @stringArray(state, this._stringArray!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="stringArray">The function to execute if the current value is of type <c>string[]</c>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string[], TResult> @stringArray,
                                                            global::System.Func<int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @stringArray(this._stringArray!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="stringArray">The function to execute if the current value is of type <c>string[]</c>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string[], TResult> @stringArray,
                                                            global::System.Func<TState, int, TResult> @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @stringArray(state, this._stringArray!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="stringArray">The instance to return if the current value is of type <c>string[]</c>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @stringArray,
                                                            TResult @int32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @stringArray;
                                                               case 2:
                                                                  return @int32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <c>string[]</c>.
                                                         /// </summary>
                                                         /// <param name="stringArray">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="stringArray"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(string[] @stringArray)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@stringArray);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <c>string[]</c>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <c>string[]</c>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <c>string[]</c>.</exception>
                                                         public static explicit operator string[](global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsStringArray;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._stringArray is null ? other._stringArray is null : this._stringArray.Equals(other._stringArray),
                                                               2 => this._int32.Equals(other._int32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._stringArray?.GetHashCode() ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._stringArray?.ToString(),
                                                               2 => this._int32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

   [Fact]
   public void Should_generate_class_with_same_member_types()
   {
      var source = """
                   using System;

                   namespace Thinktecture.Tests
                   {
                   	[Union<string, int, string, string, int?>(
                   	   T1Name = "Text",
                   	   T4IsNullableReferenceType = true)]
                   	public partial class TestUnion;
                   }
                   """;
      var outputs = GetGeneratedOutputs<UnionSourceGenerator>(source, typeof(UnionAttribute<,>).Assembly);
      outputs.Should().HaveCount(1);

      var mainOutput = outputs.Single(kvp => kvp.Key.Contains("Thinktecture.Tests.TestUnion.g.cs")).Value;

      AssertOutput(mainOutput, _GENERATED_HEADER + """
                                                   namespace Thinktecture.Tests
                                                   {
                                                      sealed partial class TestUnion :
                                                         global::System.IEquatable<global::Thinktecture.Tests.TestUnion>,
                                                         global::System.Numerics.IEqualityOperators<global::Thinktecture.Tests.TestUnion, global::Thinktecture.Tests.TestUnion, bool>
                                                      {
                                                         private static readonly int _typeHashCode = typeof(global::Thinktecture.Tests.TestUnion).GetHashCode();

                                                         private readonly int _valueIndex;

                                                         private readonly string? _string;
                                                         private readonly int _int32;
                                                         private readonly int? _nullableInt32;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsText => this._valueIndex == 1;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="int"/>.
                                                         /// </summary>
                                                         public bool IsInt32 => this._valueIndex == 2;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <see cref="string"/>.
                                                         /// </summary>
                                                         public bool IsString2 => this._valueIndex == 3;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <c>string?</c>.
                                                         /// </summary>
                                                         public bool IsString3 => this._valueIndex == 4;

                                                         /// <summary>
                                                         /// Indication whether the current value is of type <c>int?</c>.
                                                         /// </summary>
                                                         public bool IsNullableInt32 => this._valueIndex == 5;

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsText => IsText ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="int"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="int"/>.</exception>
                                                         public int AsInt32 => IsInt32 ? this._int32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="string"/>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <see cref="string"/>.</exception>
                                                         public string AsString2 => IsString2 ? this._string! : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string'.");

                                                         /// <summary>
                                                         /// Gets the current value as <c>string?</c>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <c>string?</c>.</exception>
                                                         public string? AsString3 => IsString3 ? this._string : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'string?'.");

                                                         /// <summary>
                                                         /// Gets the current value as <c>int?</c>.
                                                         /// </summary>
                                                         /// <exception cref="global::System.InvalidOperationException">If the current value is not of type <c>int?</c>.</exception>
                                                         public int? AsNullableInt32 => IsNullableInt32 ? this._nullableInt32 : throw new global::System.InvalidOperationException($"'{nameof(global::Thinktecture.Tests.TestUnion)}' is not of type 'int?'.");

                                                         /// <summary>
                                                         /// Gets the current value as <see cref="object"/>.
                                                         /// </summary>
                                                         public object? Value => this._valueIndex switch
                                                         {
                                                            1 => this._string,
                                                            2 => this._int32,
                                                            3 => this._string,
                                                            4 => this._string,
                                                            5 => this._nullableInt32,
                                                            _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                         };

                                                         private TestUnion(string? @value, int @valueIndex)
                                                         {
                                                            this._string = @value;
                                                            this._valueIndex = @valueIndex;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="int32"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to create a new instance for.</param>
                                                         public TestUnion(int @int32)
                                                         {
                                                            this._int32 = @int32;
                                                            this._valueIndex = 2;
                                                         }

                                                         /// <summary>
                                                         /// Initializes new instance with <paramref name="nullableInt32"/>.
                                                         /// </summary>
                                                         /// <param name="nullableInt32">Value to create a new instance for.</param>
                                                         public TestUnion(int? @nullableInt32)
                                                         {
                                                            this._nullableInt32 = @nullableInt32;
                                                            this._valueIndex = 5;
                                                         }

                                                         /// <summary>
                                                         /// Creates new instance with <paramref name="text"/>.
                                                         /// </summary>
                                                         /// <param name="text">Value to create a new instance for.</param>
                                                         public static TestUnion CreateText(string @text)
                                                         {
                                                            return new TestUnion(@text, 1);
                                                         }

                                                         /// <summary>
                                                         /// Creates new instance with <paramref name="string2"/>.
                                                         /// </summary>
                                                         /// <param name="string2">Value to create a new instance for.</param>
                                                         public static TestUnion CreateString2(string @string2)
                                                         {
                                                            return new TestUnion(@string2, 3);
                                                         }

                                                         /// <summary>
                                                         /// Creates new instance with <paramref name="string3"/>.
                                                         /// </summary>
                                                         /// <param name="string3">Value to create a new instance for.</param>
                                                         public static TestUnion CreateString3(string? @string3)
                                                         {
                                                            return new TestUnion(@string3, 4);
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="text">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="string2">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="string3">The action to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The action to execute if the current value is of type <c>int?</c>.</param>
                                                         public void Switch(
                                                            global::System.Action<string> @text,
                                                            global::System.Action<int> @int32,
                                                            global::System.Action<string> @string2,
                                                            global::System.Action<string?> @string3,
                                                            global::System.Action<int?> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @text(this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(this._int32);
                                                                  return;
                                                               case 3:
                                                                  @string2(this._string!);
                                                                  return;
                                                               case 4:
                                                                  @string3(this._string);
                                                                  return;
                                                               case 5:
                                                                  @nullableInt32(this._nullableInt32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes an action depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="text">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The action to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="string2">The action to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="string3">The action to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The action to execute if the current value is of type <c>int?</c>.</param>
                                                         public void Switch<TState>(
                                                            TState state,
                                                            global::System.Action<TState, string> @text,
                                                            global::System.Action<TState, int> @int32,
                                                            global::System.Action<TState, string> @string2,
                                                            global::System.Action<TState, string?> @string3,
                                                            global::System.Action<TState, int?> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  @text(state, this._string!);
                                                                  return;
                                                               case 2:
                                                                  @int32(state, this._int32);
                                                                  return;
                                                               case 3:
                                                                  @string2(state, this._string!);
                                                                  return;
                                                               case 4:
                                                                  @string3(state, this._string);
                                                                  return;
                                                               case 5:
                                                                  @nullableInt32(state, this._nullableInt32);
                                                                  return;
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="text">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="string2">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="string3">The function to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The function to execute if the current value is of type <c>int?</c>.</param>
                                                         public TResult Switch<TResult>(
                                                            global::System.Func<string, TResult> @text,
                                                            global::System.Func<int, TResult> @int32,
                                                            global::System.Func<string, TResult> @string2,
                                                            global::System.Func<string?, TResult> @string3,
                                                            global::System.Func<int?, TResult> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @text(this._string!);
                                                               case 2:
                                                                  return @int32(this._int32);
                                                               case 3:
                                                                  return @string2(this._string!);
                                                               case 4:
                                                                  return @string3(this._string);
                                                               case 5:
                                                                  return @nullableInt32(this._nullableInt32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Executes a function depending on the current value.
                                                         /// </summary>
                                                         /// <param name="state">State to be passed to the callbacks.</param>
                                                         /// <param name="text">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The function to execute if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="string2">The function to execute if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="string3">The function to execute if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The function to execute if the current value is of type <c>int?</c>.</param>
                                                         public TResult Switch<TState, TResult>(
                                                            TState state,
                                                            global::System.Func<TState, string, TResult> @text,
                                                            global::System.Func<TState, int, TResult> @int32,
                                                            global::System.Func<TState, string, TResult> @string2,
                                                            global::System.Func<TState, string?, TResult> @string3,
                                                            global::System.Func<TState, int?, TResult> @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @text(state, this._string!);
                                                               case 2:
                                                                  return @int32(state, this._int32);
                                                               case 3:
                                                                  return @string2(state, this._string!);
                                                               case 4:
                                                                  return @string3(state, this._string);
                                                               case 5:
                                                                  return @nullableInt32(state, this._nullableInt32);
                                                               default:
                                                                  throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Maps current value to an instance of type <typeparamref name="TResult"/>.
                                                         /// </summary>
                                                         /// <param name="text">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="int32">The instance to return if the current value is of type <see cref="int"/>.</param>
                                                         /// <param name="string2">The instance to return if the current value is of type <see cref="string"/>.</param>
                                                         /// <param name="string3">The instance to return if the current value is of type <c>string?</c>.</param>
                                                         /// <param name="nullableInt32">The instance to return if the current value is of type <c>int?</c>.</param>
                                                         public TResult Map<TResult>(
                                                            TResult @text,
                                                            TResult @int32,
                                                            TResult @string2,
                                                            TResult @string3,
                                                            TResult @nullableInt32)
                                                         {
                                                            switch (this._valueIndex)
                                                            {
                                                               case 1:
                                                                  return @text;
                                                               case 2:
                                                                  return @int32;
                                                               case 3:
                                                                  return @string2;
                                                               case 4:
                                                                  return @string3;
                                                               case 5:
                                                                  return @nullableInt32;
                                                               default:
                                                                  throw new global::System.ArgumentOutOfRangeException($"Unexpected value index '{this._valueIndex}'.");
                                                            }
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="int32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="int32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int @int32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@int32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion from type <c>int?</c>.
                                                         /// </summary>
                                                         /// <param name="nullableInt32">Value to covert from.</param>
                                                         /// <returns>A new instance of <see cref="TestUnion"/> converted from <paramref name="nullableInt32"/>.</returns>
                                                         public static implicit operator global::Thinktecture.Tests.TestUnion(int? @nullableInt32)
                                                         {
                                                            return new global::Thinktecture.Tests.TestUnion(@nullableInt32);
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <see cref="int"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <see cref="int"/>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <see cref="int"/>.</exception>
                                                         public static explicit operator int(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsInt32;
                                                         }

                                                         /// <summary>
                                                         /// Implicit conversion to type <c>int?</c>.
                                                         /// </summary>
                                                         /// <param name="obj">Object to covert.</param>
                                                         /// <returns>Inner value of type <c>int?</c>.</returns>
                                                         /// <exception cref="System.InvalidOperationException">If the inner value is not a <c>int?</c>.</exception>
                                                         public static explicit operator int?(global::Thinktecture.Tests.TestUnion obj)
                                                         {
                                                            return obj.AsNullableInt32;
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>true</c> if objects are equal; otherwise <c>false</c>.</returns>
                                                         public static bool operator ==(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (obj is null)
                                                               return other is null;

                                                            return obj.Equals(other);
                                                         }

                                                         /// <summary>
                                                         /// Compares two instances of <see cref="TestUnion"/>.
                                                         /// </summary>
                                                         /// <param name="obj">Instance to compare.</param>
                                                         /// <param name="other">Another instance to compare.</param>
                                                         /// <returns><c>false</c> if objects are equal; otherwise <c>true</c>.</returns>
                                                         public static bool operator !=(global::Thinktecture.Tests.TestUnion? obj, global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            return !(obj == other);
                                                         }

                                                         /// <inheritdoc />
                                                         public override bool Equals(object? other)
                                                         {
                                                            return other is global::Thinktecture.Tests.TestUnion obj && Equals(obj);
                                                         }

                                                         /// <inheritdoc />
                                                         public bool Equals(global::Thinktecture.Tests.TestUnion? other)
                                                         {
                                                            if (other is null)
                                                               return false;

                                                            if (ReferenceEquals(this, other))
                                                               return true;

                                                            if (this._valueIndex != other._valueIndex)
                                                               return false;

                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               2 => this._int32.Equals(other._int32),
                                                               3 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               4 => this._string is null ? other._string is null : this._string.Equals(other._string, global::System.StringComparison.OrdinalIgnoreCase),
                                                               5 => this._nullableInt32.Equals(other._nullableInt32),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override int GetHashCode()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               2 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._int32.GetHashCode()),
                                                               3 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               4 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._string?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0),
                                                               5 => global::System.HashCode.Combine(global::Thinktecture.Tests.TestUnion._typeHashCode, this._nullableInt32.GetHashCode()),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }

                                                         /// <inheritdoc />
                                                         public override string? ToString()
                                                         {
                                                            return this._valueIndex switch
                                                            {
                                                               1 => this._string,
                                                               2 => this._int32.ToString(),
                                                               3 => this._string,
                                                               4 => this._string,
                                                               5 => this._nullableInt32.ToString(),
                                                               _ => throw new global::System.IndexOutOfRangeException($"Unexpected value index '{this._valueIndex}'.")
                                                            };
                                                         }
                                                      }
                                                   }

                                                   """);
   }

}
